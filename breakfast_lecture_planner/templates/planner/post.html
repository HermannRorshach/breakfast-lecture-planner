{% extends 'base.html' %}
{% load static %}

{% block title %}
{{ title }}
{% endblock title %}

{% block content %}
<!-- <style>
    body {
        background-image: url("{% static 'img/345469.png' %}");
        }
</style> -->

<div class="post index">
    <div class="row">
        <div class="col-md-7 order-md-1 order-2">
            <div class="post-content">
                {{ content|safe }}
            </div>
            {% if user.is_authenticated %}
                <button id="edit-post-btn" class="btn btn-info btn-sm">Редактировать</button>

                <div id="edit-form-container" style="display: none;">
                    <form id="edit-post-form" class="full-height">
                        {% csrf_token %}
                        <input type="hidden" name="id" value="{{ object.id }}">
                        <textarea name="content" id="content" class="form-control full-height">{{ object.content }}</textarea>
                        <button type="submit" id="save-changes-btn" class="btn btn-success fixed-btn">Сохранить</button>
                    </form>
                </div>
            {% endif %}
        </div>
        <div class="col-md-5 order-md-2 order-1">
            {% if image %}
                <img src="{{ image.image.url }}" class="img-fluid" alt="Post Image">
            {% endif %}
        </div>
    </div>
    <footer class="text-center mt-4 footer">
        <p><a href="{% url 'users:login' %}">&copy;</a> {{ year }} Все права защищены. </p><br>
    </footer>
</div>



<script>
    document.getElementById('edit-post-btn').addEventListener('click', function() {
        document.getElementById('edit-form-container').style.display = 'block';
    });

    document.getElementById('edit-post-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Предотвратить перезагрузку страницы
        const formData = new FormData(this);

        fetch("{% url 'planner:post-edit' object.id %}", {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest' // Указывает, что запрос отправлен через AJAX
            }
        })
        .then(response => {
            if (response.ok) {
                return response.json(); // Предполагаем, что сервер возвращает JSON
            }
            throw new Error('Ошибка при сохранении изменений');
        })
        .then(data => {
            // Обновляем содержимое поста
            document.querySelector('.post-content').innerHTML = data.content;
            document.getElementById('edit-form-container').style.display = 'none'; // Скрыть форму
        })
        .then(data => {
            // Обновляем содержимое поста
            document.querySelector('.post-content').innerHTML = data.content;

            // Дополнительно: можно обновить посты на главной странице, если нужно
            // Это может потребовать запроса к вашему API или повторного запроса к странице
        })
        .catch(error => {
            console.error(error);
        });
    });
</script>
{% endblock content %}
